# 需求文档 - CreepVocab (WeChat Word Battle)

## 1. 项目概述

### 1.1 项目名称
 单词持久战(CreepVocab)

### 1.2 背景
本项目是一款基于微信小程序的背单词对战游戏。通过游戏化（Gamification）的方式，将枯燥的背单词过程转化为有趣的竞技活动。用户可以与好友、随机路人或 AI 进行实时对战，在 PK 中掌握词汇。

### 1.3 目标用户
*   **学生群体**：主要是大学生（四六级、考研）和高中生，需要高效且有趣的背单词工具。
*   **英语爱好者**：希望利用碎片化时间提升词汇量的人群。

## 2. 功能模块清单

| 模块 | 主要功能 | 核心页面 |
| :--- | :--- | :--- |
| **对战模块** | 好友对战、随机匹配、人机练习、对战答题、结算积分 | 首页、匹配页、对战页、结算页 |
| **单词模块** | 选词本（选择难度/分类）、生词本（错题回顾） | 选词本页、生词本列表 |
| **用户模块** | 微信登录、个人信息（段位/积分）、数据统计（胜率） | 登录页、个人中心 |
| **排行模块** | 好友排行、世界排行（日/周/月） | 排行榜页 |
| **其他** | 签到、活动公告、设置 | 首页弹窗、设置页 |

## 3. 页面流程图 (游戏主流程)

```mermaid
graph TD
    Start(打开小程序) --> CheckLogin{是否登录}
    CheckLogin -- 否 --> Login[登录页]
    CheckLogin -- 是 --> Home[首页]
    Login --> Home
    
    Home -->|好友对战| FriendMode[创建/加入房间]
    Home -->|随机匹配| RandomMode[匹配队列]
    Home -->|人机练习| AIMode[难度选择]
    Home -->|排行榜| Rank[排行榜页]
    
    FriendMode --> Battle[对战页 (10-20题)]
    RandomMode --> Battle
    AIMode --> Battle
    
    Battle -->|答题结束| Result[结算页]
    Result -->|再来一局| Battle
    Result -->|返回首页| Home
    
    Home --> Profile[个人中心]
    Profile --> WordBook[选词本]
    Profile --> WrongWords[生词本]
```

## 4. 详细页面需求

### 4.1 登录页
*   **页面名称**：登录页
*   **布局**：简洁背景，中间放置“微信一键登录”按钮，底部展示用户协议。
*   **交互**：点击唤起微信授权，获取 OpenID 和头像昵称。
*   **逻辑**：若未注册则自动注册，已注册则更新最后登录时间。

### 4.2 首页 (Home)
*   **布局**：
    *   顶部：用户信息（头像、昵称、当前段位/积分）。
    *   中部（核心入口）：三个大卡片/按钮 —— **好友对战**、**随机匹配**、**人机对战**。
    *   次级入口：选词本、生词本、排行榜、签到。
    *   底部：Banner 广告或活动入口。
*   **交互**：
    *   点击“好友对战” -> 生成邀请卡片/链接（分享给微信好友）。
    *   点击“随机匹配” -> 进入匹配动画页（寻找段位通过的对手）。

### 4.3 对战页 (Battle)
*   **页面名称**：游戏对战
*   **布局**：
    *   **顶部**：双方头像、昵称、当前分数条 (Score Bar)。
    *   **中部**：倒计时圆环 (e.g., 10s)、当前单词（英文）。
    *   **底部**：4个选项卡片（中文释义）。
*   **交互逻辑**：
    *   **即时反馈**：点击选项后，立即判断正误。Green=Correct, Red=Wrong。
    *   **进度同步**：显示对手的答题进度（如对手答对，其分数条增长）。
    *   **连击效果**：连续答对触发 Combo 动画。
    *   **音效**：正确/错误/倒计时音效。
*   **数据字段**：
    *   当前题目 (`word`, `options`, `correctIndex`)
    *   剩余时间 (`timeLeft`)
    *   双方分数 (`myScore`, `opponentScore`)

### 4.4 结算页 (Result)
*   **页面名称**：对战结果
*   **布局**：
    *   显示胜负结果（Victory/Defeat）。
    *   双方最终得分、获得的积分/金币奖励。
    *   **本次生词**：列出本局答错的单词，支持一键加入生词本。
    *   按钮：再来一局、分享战绩、返回首页。

### 4.5 选词本 & 生词本
*   **选词本**：列表展示可选词库（四级、六级、考研、雅思、托福）。点击切换当前词库。
*   **生词本**：列表展示历史错题。每行显示单词、释义、无论是否掌握（可移除）。

## 5. 非功能性需求

*   **实时性**：对战过程要求低延迟（WebSocket），保证双方分数同步 < 200ms。
*   **并发**：Spring Cloud 后端需支持高并发匹配，避免匹配超时。
*   **UI/UX**：富有游戏感的动效（如粒子效果、震动反馈），符合“轻竞技”风格。

## 6. 技术栈选型

### 6.1 前端 (uni-app)
*   **框架**：uni-app (Vue 3)
*   **组件库**：wot-design-uni (使用其 Button, Popup, Toast, Card 等组件)
*   **通信**：WebSocket (用于实时对战信令交互)
*   **状态管理**：Pinia (存储 UserInfo, SocketState)

### 6.2 后端 (Spring Cloud)
* **Gateway**：网关鉴权。

* **Nacos**：服务注册。

* **Auth Service**：微信登录鉴权。

* **Match Service**：匹配队列服务（Redis List 或 Redisson 实现）。

* **Battle Service**：对战逻辑、WebSocket 消息推送、积分结算。

*   **Word Service**：词库管理、生词本 CRUD。

## 7. 接口需求 (核心 API)

| 接口描述 | 方法 | 路径 | 说明 |
| :--- | :--- | :--- | :--- |
| **登录** | POST | `/api/auth/login` | 微信 Code 换 Token |
| **获取长连接** | WS | `/ws/battle` | 建立 WebSocket 连接 |
| **加入匹配** | POST | `/api/match/join` | 加入随机匹配队列 |
| **提交答案** | WS | `Event: ANSWER` | 发送 {gameId, questionId, answer, timeSpent} |
| **获取词库** | GET | `/api/word/books` | 获取可选词书列表 |
| **获取生词** | GET | `/api/word/wrong` | 分页获取生词 |
| **排行榜** | GET | `/api/rank/list` | 获取 Top 100 |

## 8. 数据表设计 (ER 初步)

*   **User**: `id`, `openid`, `nickname`, `score` (积分/段位), `word_book_id` (当前词书)
*   **Word**: `id`, `text`, `phonetic`, `definition`, `book_id`
*   **WordBook**: `id`, `name`, `level`, `img_url`
*   **MatchRecord**: `id`, `user1_id`, `user2_id`, `winner_id`, `create_time`
*   **WrongBook**: `id`, `user_id`, `word_id`, `error_count`
